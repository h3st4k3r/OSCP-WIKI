`reg query` permite inspeccionar el registro de Windows desde consola. Es fundamental en post-explotación para detectar:
- Persistencia
- Credenciales almacenadas
- Configuraciones sospechosas

---

## 1. Sintaxis básica
```cmd
reg query <ruta> [/s]
```

- `/s`: recursivo, enumera todas las subclaves y valores

Ejemplo:
```cmd
reg query HKCU\Software
```

---

## 2. Claves comunes a revisar

### Autostart (persistencia)
```cmd
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
```

### Servicios y ejecutables sospechosos
```cmd
reg query HKLM\System\CurrentControlSet\Services
```

### Configuración de PowerShell
```cmd
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell
reg query HKCU\Software\Microsoft\PowerShell
```

### Credenciales (a veces almacenadas por error)
```cmd
reg query "HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"
```

---

## 3. Buscar valores específicos
```cmd
reg query HKCU /f "password" /t REG_SZ /s
```
- `/f`: valor a buscar
- `/t`: tipo (ej: REG_SZ, REG_DWORD)
- `/s`: recursivo

---

## 4. Exportar para análisis offline
```cmd
reg export <ruta_clave> archivo.reg
```

Ejemplo:
```cmd
reg export HKCU\Software datos.reg
```

---

## Uso OSCP-style
- Ver si hay persistencia en claves `Run`, `Services`, `Image File Execution Options`
- Buscar restos de payloads, rutas a binarios extraños o comandos `powershell -enc`
- Correlacionar con `schtasks`, `wmic`, `autoruns`

---
